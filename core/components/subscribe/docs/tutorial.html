<p>Subscribe provides a double-opt-in User registration system. It uses some parts of the Login package, so be sure the Login package is installed before using Subscribe.</p>

<div class="box">
<p><b>Important Upgrade Note!</b></p>

<p>A number of element and directory names have changed and quite a few internal changes were made to make Subscribe easier to configure and to avoid conflicts with other extras. All of the default chunks and snippets have been renamed.</p>

<p>Since everything was changing, I took the opportunity to refactor Subscribe from the ground up to streamline the code and, hopefully, to make it much easier to use and configure.</p>
    
<p>The good news is that the new version installs everything you need except the login page and automatically configures everything (with the exception of the System Setting for the login page if your login page has an alias other than &quot;login&quot;). Be sure to read this whole section carefully before upgrading from version 1.1.0 or earlier. The upgrade is easier than it sounds. The simplest method, by far, is to completely uninstall and remove the old version, including any Resources except the Login page.</p>
    
<p>All &quot;sm&quot; and &quot;Sm&quot; prefixes have been changed to &quot;sbs&quot; and &quot;Sbs&quot; to avoid conflicts with other extras. If you've created a custom CSS file be sure to back it up outside the subscribe directory, though it will be of limited use because many of the classes and IDs have changed.</p>
    
<p><b>IMPORTANT!</b>You must either delete the Subscribe Resources (except the Login page) or change their aliases. If you don't, the install will be corrupted. You may want them for reference, but it's not necessary. If you do keep them, be sure to change the aliases on all but the Login Resource. Subscribe will create new Resources for you in a folder called &quot;Subscribe Folder&quot;. These are the resources that will be used by Subscribe. You can alter them, since future installs will have the option not to install them. You can delete your old resources once you are satisfied with the new ones. Be sure not to copy the contents of your old resources in to the new ones since the tags have changed. I apologize for the inconvenience. Future upgrades should go much more smoothly.</p>
    
<p>If you have created any new Tpl chunks for Subscribe, they will survive the upgrade, but they may not be in the Subscribe category after the install and they really won't be of any use because all the Tpl chunks have changed.</p>    
    
<p>If you are upgrading from version 1.1.0 and have made changes to the default Tpl chunks (generally a bad practice), you may want to back them up by duplicating them so you'll have them for reference, then uninstall and remove the Subscribe package before downloading and installing the new version. You can delete your backup chunks once you have the new ones the way you want them.</p> 

<p>In the new version, your login page should be outside of the Subscribe package and should have an alias of &quot;login&quot; or &quot;Login&quot;. Be sure the page exists before installing Subscribe so that the package can set the Login Page ID System Setting correctly. If you forget, or your Login page has a different alias, set that System Setting manually in System | System Settings (namespace: subscribe). 
</p>
  
<p>Users now get added to the Subscriber User Group with a Role of Subscriber. Be sure that both the User Group and the Role exist.</p>   

</div>
<h3>About Subscribe</h3>
<p>Subscribe provides a request-to-subscribe message that will appear on pages at your site. When Users choose to subscribe and submit the registration form, they receive an email message with a link to confirm their registration. The request-to-subscribe message will not be shown to Users who are logged in (they will see a logout link). You can also hide the request-to-subscribe message on selected pages with the <fixedpre>&noShows</fixedpre> property in the SubscribeRequest snippet tag.</p>
        
<p>As soon as a User submits the Registration form, a User record and a User Profile for the User are saved in the MODX database, but with the User marked as inactive. When the User responds by clicking on the link in the email, they are taken to the site, marked as active, logged in, and sent to a &quot;Registration Confirmed&quot; page.</p>
        
<p>The default registration form also includes the option of checkboxes for the User to indicate interests. The User's interests will be saved as a comma-separated list in the <fixedpre>comment</fixedpre> field of the User's Profile (or, optionally, in an extended field of your choice). This allows you to send email messages to Users based on their interests (an upcoming version of EmailResource will do this automatically as will an upcoming extra called &quot;Notify&quot;). You can also design systems that respond to User interests by customizing menus, forwarding Users to particular parts of the site on login, etc.</p>

<p>There is also a Manage Preferences form that lets the user change their interests at any time. It also allows the user to unsubscribe.</p>

<h3>Installing Subscribe</h3>

<p>
Go to System | Package Management on the main menu in the MODX Manager and click on the "Download Extras" button. That will take you to the Revolution Repository (AKA Web Transport Facility). Put Subscribe in the search box and press Enter. Click on the "Download" button, and when it changes to "Downloaded," click on the "Finish" button. That should bring you back to your Package Management grid. Click on the "Install" button next to Subscribe in the grid. The Subscribe package should now be installed.</p>

<p>If you have not installed the Login package, do that before continuing and create a Login page (if you don't already have one) with the alias of &quot;login&quot;. The minimum content for that page is:</p>
        
<pre><fixedpre>
[[!Login]]
</fixedpre></pre>        

<h3>Displaying the Request to Subscribe Message</h3>        

<p>Put the following tag in the <fixedpre><body></fixedpre> section of any templates for pages that should show the request-to-subscribe. In the <fixedpre>&noShows</fixedpre> property, put a comma-separated list containing the IDs of other pages where the request should not be shown. By default, the request is not shown on the Login, Registration, Thanks for Registering, and Confirm Registration pages. Add the IDs of any other pages it should not be shown on to the <fixedpre>&noShows</fixedpre> property in the snippet tag in the template. The tag will be replaced by the &quot;Request to Subscribe&quot; message (which, by default, appears horizontally on a single line) for users who are not logged in and by the &quot;Logout&quot; link for users who are logged in.</p>
<pre><fixedpre>
[[!SubscribeRequest]]

or

[[!SubscribeRequest
    &noShows=`##,##,##`
]]
</fixedpre></pre>

<p>Replace &quot;##&quot; with the Resource IDs of any pages where you don't want to show the Subscribe Request.</p>  
        
<h3>Creating the User Group and Role</h3>
        
<p>Subscribe (via the Register snippet) adds new users to the Subscribers User Group with a Role of Subscriber. <b>IMPORTANT:</b> Both must exist before the first user registers. The current version of the Register snippet will not register the Group or Role if they don't exist. The user will be created, but won't be a member of any group.</p>

<p>To create the User Group, go to Security | Access Controls | User Groups tag. Click on the &quot;New User Group&quot; button. Enter <fixedpre>Subscribers</fixedpre> for the name. Add a description if you want one. Then, click on the &quot;Save&quot; button. To create the Role, click on the &quot;Roles&quot; tab, then on the &quot;Create New&quot; button. Enter <fixedpre>Subscriber</fixedpre> for the role, add a description (optional), and enter a number between 0 and 9999 (I use 50) for the &quot;Authority&quot; level. Then click on the &quot;Save&quot; button.</p>
        
<h3>Subscribe System Settings</h3>
        
<p>The Subscribe System Settings containing page IDs will be set automatically during the install, but you may want to check to make sure they are set correctly. Go to System | System Settings and select the &quot;subscribe&quot; namespace in the dropdown menu at the top of the grid (the &quot;core&quot; namespace will be showing by default). Note that the &quot;subscribe&quot; namespace may be on page two of the list.</p>

<p>In the current version, rather than setting properties in multiple places, you only need to set the basic System Settings and they'll be used by all parts of the subscribe package. This means you shouldn't need to modify any tags in the chunks. The Settings can be overridden by properties in the Subscribe snippet tags, but you should rarely, if ever, need to do that.</p>


<h3>Testing</h3>

<p>Before testing, clear the cache and make sure that the following resources are published and hidden from menus (unless you want to show the Register page in the menu).</p>
        
<ul>
    <li>Register</li>
    <li>Confirm Register</li>
    <li>Registration Confirmed</li>
    <li>Thank You for Registering page</li>
    <li>Manage Preferences</li>
</ul>


<p>Test your system by visiting the site from another browser where you are not logged in to the Manager. When you are logged in to the Manager and are previewing the site, your login status is ambiguous. You're logged in, but not to the 'web' context, so Subscribe's login status checks can give odd results.</p>

<p>It's recommended that you test the Subscribe system as installed before modifying it to meet your needs (but check the Login Page ID System Setting to make sure it is set correctly).</p>

<p>Go to the Register page and register as a new User. See if you get the email and, if so, use the link in the email to confirm the registration. You should end up on the Registration Confirmed page. If that doesn't all happen, check the publication status of the resources -- all should be published. If they are, check the various Resource IDs in the Subscribe System Settings.</p>

<p>Next, log in to the Manager. Check to make sure that the new User exists and is active. go to Security | Manage Users. Right-click on the new user and select &quot;Update User&quot;. Check the <fixedpre>comment</fixedpre> field of the User Profile to make sure that the interests are recorded there. Delete the User.</p>

<h3>Customizing Subscribe</h3>

<p>You will definitely want to change the preferences list used in the Registration form and the Manage Preferences form. To set the availble preferences, duplicate the <fixedpre>sbsPrefListTpl</fixedpre> chunk (call it MysbsPrefListTpl) and edit the entries. Then set the <fixedpre>prefListTpl</fixedpre> System Setting to &quot;MysbsPreflistTpl&quot;.</p>

<p>The format for the Preferences List Tpl chunk is a series of <fixedpre>value==caption</fixedpre> pairs separated by <fixedpre>||</fixedpre>:</p>
        
<pre><fixedpre>
Option1==Caption one||Option2==Caption two||Option3==Caption three    
</fixedpre></pre>
        
<p>The caption is what will be shown in the form. The value is what will be stored in the database.</p>

<p>There is JavaScript validation for all fields in the Register form. All fields are required. The Username and Password fields are required to be at least 6 characters long and the two Password fields must match. The Email field is also checked to make sure it's a valid address. The User must also check at least one of the &quot;Interests&quot; checkboxes.</p>

<p>By default, the user's preferences are stored in the <fixedpre>comment</fixedpre> field of the User Profile. This is the preferred method because retrieving the user's preferences in code and displaying them on a page will be much faster and easier. If you need the <fixedpre>comment</fixedpre> field for something else, you can change the method used and have the preferences stored in an extended field of the User Profile. To do so, just go to System | System Settings, select the &quot;subscribe&quot; namespace, and change the <fixedpre>Use Comment Field</fixedpre> setting to <fixedpre>No</fixedpre>. The user's preferences will be stored in an extended field in the User Profile called &quot;interests&quot;. If you need to change the name of that field, you can modify the <fixedpre>Subscribe Extended Field</fixedpre> System Setting.</p>
        
        
<h3>Styling the forms</h3>

<p>The &quot;request-to-subscribe&quot; message is styled to be appear on a single horizontal line, but you can restyle it with CSS to appear in another form since the message and all buttons are contained in identifiable <fixedpre><span></fixedpre> tags with the text inside them in <fixedpre><a></fixedpre> tags.</p>
        
<p>The default styling for the message is <fixedpre>float:right</fixedpre>, but you can change the CSS file. Be sure to change both the loggedInDisplay and the loggedOutDisplay. You may want to leave the float, but keep other elements from wrapping around the message. If so, you can add <fixedpre><div style="clear:both"></div></fixedpre> above, and/or below the message in your template.</p>

<p>Both the Register form and the &quot;request-to-subscribe&quot; message are styled with the /assets/components/subscribe/css/subscribe.css file, as are the two popup windows. See the section below on modifying the CSS.</p>

<p>I originally had a nice JQuery slider for the two popups, but since they might be loaded for every page on a site, I decided that the speed penalty involved in loading the JQuery core, UI, and CSS files was just not worth it. The popups are now done with CSS and a tiny bit of embedded JavaScript to toggle their visibility. You can modify their position and appearance in the subscribe.css file.</p>

<p>To change the message in the popups, duplicate the <fixedpre>sbsPrivacyDialogTextTpl</fixedpre> and <fixedpre>sbsWhyDialogTextTpl</fixedpre>chunks. Add &quot;My&quot; as a prefix to their names and modify the follwoing two Subscribe System settings to match: <fixedpre>whyDialogTextTpl</fixedpre> and <fixedpre>&privacyDialogTextTpl</fixedpre>.</p>

<p>As currently styled, the popups will automatically expand to match the content length.</p>

<h3>Modfying the CSS</h3>

<p>
If you want to modify the CSS of JS used for Subscribe, it's best to duplicate the subscribe.css and/or subscribe.js file so they won't be overwritten by upgrades:</p>
<pre><fixedpre>
assets/components/subscribe/css/subscribe.css
assets/components/subscribe/js/subscribe.js
</fixedpre></pre>

<p>
You can specify the files to be used with the your CSS file with the <fixedpre>cssPath</fixedpre>, <fixedpre>cssFile</fixedpre>, <fixedpre>jsPath</fixedpre>, and <fixedpre>jsFile</fixedpre> System Settings. If your files are in the same directory as the originals, you only need to modify the <fixedpre>cssFile</fixedpre> and/or <fixedpre>jsFile</fixedpre> settings.
</p>

<p>If you want to add the CSS to your main CSS file, set the <fixedpre>cssFile</fixedpre> seting to <fixedpre>none</fixedpre> and the CSS file will not be loaded.</p>

<h3>Modifying the Tpl Chunks</h3>
        
<p>All the Tpl chunks used by Subscribe are settable with properties. When MODX is looking for a property, it will use a property set in the snippet tag, but if no property is set there, it will check the System Settings table for the property. Because Subscribe uses the same properties in different chunks and snippets, the Tpl chunk names are set as System Settings. You can override them with properties in the snippet tags and chunks, but using the System Settings is easier and more reliable.</p>

<p>
If you want to modify any of the default Tpl chunks, duplicate them and change the name by adding &quot;My&quot; as a prefix. Then, modify the value of the appropriate Subscribe System Setting by adding &quot;My&quot; as a prefix. Go to System | System Settings and select the &quot;subscribe&quot; namespace in the drop-down list at the top of the grid. You can click in the plus sign to see a description of each setting. Double-click on the value of the setting you want to change, change it, and click somewhere else in the grid. Be careful &mdash; the names are case-sensitive, and if you misspell them in the System Settings grid, Subscribe will continue to use the default Tpl chunks, CSS, and JS files.</p>

<p>&nbsp;</p>

