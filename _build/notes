Subscribe snippet loads css, loads toggle js
Sets the SbsSubscribe placeholder:

properties:

loginPageId
managePrefsPageId
loginButtonText (lexicon)
logoutButtonText (lexicon)
managePrefsButtonText (lexicon)
requestMessageText (lexicon)
whyDialogButtonText (lexicon)
* whyDialogTpl
* wyhDialogText
privacyDialogButtonText (lexicon)
* privacyDialogTpl
* privacyDialogText

[[+sbs_subscribe_display]] (request or logout/manage)

to one of two chunks:

* SbsLoggedInDisplayTpl

[[+sbs_logout_button]] [[+sbs_manage_prefs_button]]

sbsLoggedOutDisplayTpl

[[+sbs_request_message]][[+sbs_why_dialog_button]][[+sbs_privacy_dialog_button]] [[+sbs_subscribeme_button]][[+sbs_login_button]]

--------

SbsForm Snippet
Properties
registerFormTpl
managePrefsFormTpl
submitButtonText (lexicon)
form (manage_prefs or register)
unsubscribe success message (lexicon)
register success message (lexicon)
change prefs success message (lexicon)
change prefs error message (lexicon)
forwardOnRegisterId (default empty)

loads css
loads appropriate JS
loads appropriate Tpl chunk

Sets appropriate ones of these:
[[+sbs_error]]
[[+sbs_success]]
[[+sbs_username]]
[[+sbs_current_prefs]]
[[+sbs_form]] (from one of two Tpls RegisterFormTpl/ManagePrefsFormTpl based on $form property)
[[+sbs_preferences_list]] (no, it's a chunk tag in the Tpl chunk)
[[+sbs_unsubscribe_option]]
<br />[[+sbs_unsubscribe]]

* RegisterFormTpl
[[Register
  &some placeholders here
]]
[[+sbs_error]]
[[+sbs_success]]
[[+sbs_register_form]]


SbsFormJs
SbsEmailCheckJS
SbsPreferences JS
JS in two files: register.form.js manage.prefs.form.js


Build in getinterests snippet.

*ManagePrefsFormTpl
[[+sbs_error]]
[[+sbs_success]]
<p>Username: [[+username]]</p>
<p>current preferences: [[+current_prefs]]</p>
<br />
<p>fill out this form</p>
[[$SbsInterestList]]
<br />
[[+sbs_unsubscribe]]

On submit. Check for errors with no JS on.
Try no posthook, save prefs ourselves (above register snippet)

SbsForm snippet
---------------
Use for both forms
&form=`register`
&form=`managePrefs`

Load CSS
Load single JS file (add unsubscribe js code)
if (register)
    Load register form Tpl
    Load preferences Tpl
    Don't forward from Register form?
if (managePrefs)
    load preferencesTpl
    load Unsubscribe Tpl

create checkbox line Tpl chunk

---------------------
SbsRecordPreferences snippet

if (RegisterForm) {


} else if (ManagePrefs form) {
   getCurrent Prefs
   setPlaceholder()
   if (is repost) {
       change preferences
   }
}

-----------------------
SubscribePreferences class

Member variables
----------------
modx
props
method (comment/extended)
tpls[]
    preferencesOuterTpl
    preferencesRowTpl
    preferencesPrefListTpl
errors (array)
possiblePreferencesArray (array)
postPreferencesArray
storedPreferencesArray

markCurrent

Methods
-------
protected getTpls
public setMethod()
public getMethod()
public savePreferences()
protected setError()
protected getErrors()
protected getPossiblePreferences()
protected getPostPreferences()
protected getStoredPreferences()
   uses method, checkCurrent
   $_POST['interests'] overrides
createDisplay()



---------
Subscribe Operation

switch($form) {
   case 'register':
      load JS
      load lexicon
      set lexicon JSON
      if (repost) {
          get user obj and profile from hook
          save preferences (method)
          /* register snippet will forward */
      } else {
         render prefs (method,
         set placeholder
      }
      break;
   case 'managePrefs':
      load JS
      load lexicon
      set lexicon JSON
      get user object from DB
      if (repost) {
         if (unsubscribe) {
            unsubscribe user
            render prefs from DB
            set prefs placeholder
            set success message

         } else {
            get user profile with getOne()
            save preferences (method)
            render prefs from post
            set prefs placeholder
            set success message
         }
      }
   case SubscribeRequest:
     if (loggedin)
        render loggedInDisplay
     else {
        render loggedOutDisplay
     }


}

----------
Make all resource IDs System Settings in Subscribe area and use [[++setting_name]] in forms.

Login Page Id
sbs_login_page_id
108

Manage Preferences Page ID
sbs_manage_prefs_page_id
327

Subscribe Method
sbs_method
comment

Register Page Id
sbs_register_page_id
326

Registration Confirmed Page Id
sbs_registration_confirmed_page_id
330

Thanks for Registering Page Id
sbs_thank_you_page_id
329

Subscribe storage method
sbs_method
comment

Subscribe Field Name
sbs_field_name
interests


fix properties = 'Array'


fix settings=array() versus systemSettings =   [no fix needed?  Check what build.transport.php wants.
add snippet_get_contents for snippets and plugins and use it in transport get contents.

check fields for transport.tvs.php